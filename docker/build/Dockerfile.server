# Linux with node install after for a lighter container
FROM alpine
RUN apk add --update nodejs npm

ENV ENVIRONMENT_MODE production

WORKDIR /root

# NPM install
COPY ./server/package.json ./
COPY ./server/package-lock.json ./
RUN npm ci

# Copy files
COPY ./server/tsconfig.json ./
COPY ./server/src ./src/

RUN npm run build

EXPOSE 80:80
EXPOSE 443:443

ENTRYPOINT [ "node", "./dist/index.js" ]